#!/usr/bin/python

import os

full = '/sys/class/power_supply/BAT0/%s_full'
now = '/sys/class/power_supply/BAT0/%s_now'
status = '/sys/class/power_supply/BAT0/status'
name = 'charge'

if not os.path.exists(full % name):
  name = 'energy'

if os.path.exists(full % name):
  with open(status) as s, open(full % name) as f, open(now % name) as n:
      charge = float(n.read()) / float(f.read())
      status = s.read().rstrip()
      if status != 'Charging':
        scolor = '#ff0000'
      else:
        scolor = '#0000ff'

      red = 255
      green = 255
      if charge > 0.5:
        red = int(2 * (1-charge)*255)
      else:
        green = int(2*charge*255)

      ccolor = '#%02x%02x00' % (red, green)

      print '<fc=%s>(</fc><fc=%s>%d%%</fc><fc=%s>)</fc>' % (scolor, ccolor, charge * 100, scolor)
